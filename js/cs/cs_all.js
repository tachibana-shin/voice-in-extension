function onload(){let e=!1;function t(...t){e&&console.log(...t)}var n;e=e||"true"===localStorage.viDebug,String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return this.split(e).join(t)});var a=[".","?","!","\n"],o=!1,r=!1,c=!1,l=!1,i=!1,s="",d=!1,p=!1,m=!1;const u=["classroom.google.com","www.google.com","outlook.live.com","docs.google.com","meet.google.com","translate.google.com","discord.com","www.messenger.com","www.linkedin.com","quizlet.com","www.teamwork.com","www.instagram.com","www.carousell.com.hk","outlook.office.com","outlook.office365.com","web.whatsapp.com","dictanote.co","localhost:8000","mail.yahoo.com","www.bing.com","www.twitch.tv","www.youtube.com"],f=[".zendesk.com",".force.com",".hubspot.com"],g=["www.notion.so","www.youtube.com","classroom.google.com","app.hubspot.com"],h=["mail.google.com"];var v="";function b(){try{return new URL(s).host}catch(e){return"unknown.com"}}function x(){var e=document.activeElement;return e&&"IFRAME"!==e.tagName?document:null}function T(){var e=document.activeElement,t=document;if(!e||"IFRAME"===e.tagName)return null;for(;null!==e.shadowRoot;)t=e.shadowRoot,e=e.shadowRoot.activeElement;return t}function w(){var e=document.activeElement;return e&&"IFRAME"!==e.tagName?window:null}function y(){var e=function(){var e=document.activeElement;if(!e||"IFRAME"===e.tagName)return null;for(;null!==e.shadowRoot;)e=e.shadowRoot.activeElement;return e}(),t=!1;return e&&("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName||e.isContentEditable)&&document.hasFocus()&&(t=!0),{targetable:t,target:e}}let E="";function k(e){function d(e){return e.replace(/\S/,(e=>e.toUpperCase()))}function m(e){if("INPUT"===e.tagName||"TEXTAREA"===e.tagName){var t=e.selectionStart,n=e.value,a=Math.max(n.lastIndexOf(" ",t),0),o=Math.max(n.lastIndexOf("\n",t)+1,0),r=Math.max(a,o),c=n.slice(0,r)+n.slice(t);return e.value=c,void e.setSelectionRange(r,r)}const l=["SPAN","FONT","B","I","U"];function i(e){let t=e.previousSibling;if(!t){const t=e.parentNode;return-1!==l.indexOf(t.nodeName)?i(t):null}for(;3!==t.nodeType&&1===t.nodeType&&-1!==l.indexOf(t.nodeName);)t=t.childNodes[t.childNodes.length-1];return 3===t.nodeType?t:null}var s=T();if(s&&s.getSelection){var d=s.getSelection().getRangeAt(0);if(d.collapsed||d.deleteContents(),d.collapse(!1),d.collapsed){var p,m=d.startContainer,u=d.startOffset,f=m,g=u,h=!1;if(3!==f.nodeType)(p=g!==f.childNodes.length?i(f.childNodes[g]):i(f))?(f=p,g=p.textContent.length):h=!0;for(;!h;){var v=f.textContent.lastIndexOf(" ",g);if(-1!==v){h=!0,g=v;break}var b=i(f);if(!b){g=0,h=!0;break}f=b,g=b.textContent.length}const e=document.createRange();e.setStart(f,g),e.setEnd(m,u),e.deleteContents()}}}function u(e,n){if(-1===["yue-Hant-HK","ja-JP","cmn-Hans-HK","cmn-Hans-CN"].indexOf(v)){t(`prev text:"${n}"`);var o=n.length>0&&-1!==["\n"," ",String.fromCharCode(160)].indexOf(n[n.length-1]);if(n=n.trim(),"ce"===p)e=e.replace(/(^\w{1})|(\s+\w{1})/g,(e=>e.toUpperCase()));else{var r="lc"===p||"uc"===p;r||!function(e,t){for(var n=0;n<t.length;n+=1){var a=t[n];if(e.slice(e.length-a.length)===a)return!0}return!1}(n,a)&&0!==n.length&&""!==n&&void 0!==n&&"null"!==n||(e=d(e)),!r&&v.startsWith("en-")&&(e=e.replace(/\bi\b/g,(()=>"I")))}n.length>0&&!o&&-1===["(","/","‘","“","-","–"].indexOf(n[n.length-1])&&-1===[".",",",";",":","?","!",")","’","”"," ",String.fromCharCode(160),"-","–"].indexOf(e[0])&&(e=" "+e)}return t(`finalText "${e}"`),e}function f(){const e=b(),n=x(),a=w();n.body.classList.contains("voicein_ready")||(-1===g.indexOf(e)&&"true"!==localStorage.EnablePasteHandler?(t("[PrepTarget] Paste Trapper Not Enabled"),n.body.classList.add("voicein_ready")):(t("[PrepTarget] Prepped Target",n.body),a.addEventListener("paste",(e=>{c&&document.activeElement&&"INPUT"!==document.activeElement.nodeName&&(e.stopImmediatePropagation(),t("Stopped Paste Propogation"))}),!0),n.body.classList.add("voicein_ready")))}function y(e){for(let t=0;t<e.length;t+=1){let n=e[t];n.length>0&&" "===n[0]&&(n=n.slice(1),e[t]=n),n.length>0&&" "===n[n.length-1]&&(e[t]=n.slice(0,n.length-1))}}const k=navigator.platform.toUpperCase().indexOf("MAC")>=0?91:17;function C(e,t){window===window.top&&"https:"===window.location.protocol?navigator.clipboard.writeText(e).then((()=>{t(),document.activeElement&&"INPUT"===document.activeElement.nodeName&&document.activeElement.dispatchEvent(new KeyboardEvent("keyup",{keyCode:k}))})).catch((e=>{console.error("Could not copy text: ",e)})):chrome.runtime.sendMessage({message_id:"copy_text",value:e},(e=>{e&&t()}))}function N(e,n){t(`pasteTextIntoTarget "${n}"`),f();const a=(n=(n=n.replaceAll("<newline>","\n")).replaceAll("<newparagraph>","\n\n")).split(/(<[a-z]+>)/g);var o=x(),c=()=>{o.execCommand("paste",!1)};a.length>1&&y(a);for(let t=0;t<a.length;t+=1){let n=a[t];if(n)switch(n){case"<capitalize>":i=!0;break;case"<capson>":l=!0;break;case"<capsoff>":l=!1;break;case"<newparagraph>":C("\n\n",c),E="";break;case"<insertspace>":C(String.fromCharCode(160),c),E+=String.fromCharCode(160);break;case"<newline>":C("\n",c),E="";break;case"<deleteword>":if(r){m(e);break}case"<undo>":if(r){o.execCommand("undo");break}default:{i&&(n=d(n),i=!1),l&&(n=n.toLocaleUpperCase());const e=u(n,E);C(e,c),E+=e}}}}function S(e,t,n,a){let o=t;return a&&"input"===a.localName?o=e.replace(/(\S)\n+(\S)/g,"$1 $2"):(a&&"textarea"===a.localName||n&&"text/plain"===n.type)&&(o=e),o}function A(e,t){if("paste"===e.event.eventType&&!t.plainText&&!t.richText)return!0;const n=function(e,t){const{eventInit:n,eventDataFormat:a}=e;if(a){if(a.dataTransfer){const e=new DataTransfer;a.dataTransfer.forEach((n=>{const a=S(t.plainText,t.richText,n,t.element);e.setData(n.type,a)})),n.dataTransfer=e}if(a.clipboardData){const e=new DataTransfer;a.clipboardData.forEach((n=>{const a=S(t.plainText,t.richText,n,t.element);e.setData(n.type,a)})),n.clipboardData=e}}return new window[e.event](e.eventType,e.eventInit)}(e.event,t);return t.element.dispatchEvent(n)}function I(e,t){let n=e.customFillValue;n||(n=e.fillFormat?S(t.plainText,t.richText,e.fillFormat,t.element):void 0),t.element.ownerDocument.execCommand(e.command,!1,n)}function R(e,t){if(!(t.element instanceof HTMLInputElement||t.element instanceof HTMLTextAreaElement))throw new Error("fillElementValue received element not of type input or textarea");const n=t.element,a="string"==typeof t.replaceTextSuffix?t.replaceTextSuffix:" ",o=S(t.plainText,t.richText,e.fillFormat,t.element)+a,r=n.selectionStart,c=n.selectionEnd;n.value=n.value.substring(0,r)+o+n.value.substring(c,n.value.length),function(e,t){e.element.setSelectionRange(t,t)}(t,r+o.length)}function _(e,n){t(`insertAdvanced "${n}"`),f();const a=function(e){const t=[{actionGroups:[],urlRegexes:["facebook\\.com","messenger\\.com"]},{actionGroups:[],selectors:['[contenteditable]:not([contenteditable="false"])'],urlRegexes:["docs\\.google\\.com/spreadsheets"]},{actions:[{actionType:"dispatchEvent",event:{event:"ClipboardEvent",eventDataFormat:{clipboardData:[{type:"text/plain"}]},eventInit:{bubbles:!0,cancelable:!0,composed:!0},eventType:"paste"}},{actionType:"dispatchEvent",event:{event:"InputEvent",eventDataFormat:{dataTransfer:[{type:"text/plain"}]},eventInit:{bubbles:!0,cancelable:!0,composed:!0,detail:0,inputType:"insertFromPaste"},eventType:"beforeinput"}},{actionType:"execCommand",command:"insertText",fillFormat:{type:"text/plain"}}],selectors:['[contenteditable]:not([contenteditable="false"])']},{actions:[{actionType:"dispatchEvent",event:{event:"InputEvent",eventDataFormat:{dataTransfer:[{type:"text/plain"}]},eventInit:{bubbles:!0,cancelable:!0,composed:!0,detail:0,inputType:"insertFromPaste"},eventType:"beforeinput"}},{actionType:"execCommand",command:"insertText",fillFormat:{type:"text/plain"}}],selectors:["input","textarea"]},{actions:[{actionType:"dispatchEvent",event:{event:"InputEvent",eventDataFormat:{dataTransfer:[{type:"text/plain"},{type:"text/html"}]},eventInit:{bubbles:!0,cancelable:!0,composed:!0,detail:0,inputType:"insertFromPaste"},eventType:"beforeinput"}},{actionType:"fillElementValue",fillFormat:{type:"text/plain"}},{actionType:"dispatchEvent",event:{event:"InputEvent",eventDataFormat:{dataTransfer:[{type:"text/plain"},{type:"text/html"}]},eventInit:{bubbles:!0,cancelable:!0,composed:!0,detail:0,inputType:"insertFromPaste"},eventType:"input"}},{actionType:"dispatchEvent",event:{event:"InputEvent",eventInit:{bubbles:!0,cancelable:!1,composed:!1},eventType:"change"}}],selectors:["input","textarea"]},{actionGroups:[],selectors:[':not([contenteditable="false"])']}];return"INPUT"===e.tagName||"TEXTAREA"===e.tagName?t[3]:t[2]}(e),o=x();function c(e,n){var o,r={element:e,plainText:n,richText:(o=n,o.length>0&&" "===o[0]&&(o="&nbsp;"+o.substring(1)),""+(o=(o=o.replaceAll("  "," &nbsp;")).replaceAll("\n","<br>"))),replaceTextSuffix:""};let c=!0;for(let e=0;e<a.actions.length;e+=1){const n=a.actions[e];if(c||n.forceExecution)switch(n.actionType){case"dispatchEvent":c=A(n,r);break;case"execCommand":I(n,r);break;case"fillElementValue":R(n,r);break;default:t("Unknown action type: "+n.actionType)}}}const s=(n=(n=(n=n.replaceAll("<newparagraph>","\n\n")).replaceAll("<newline>","\n")).replaceAll("<insertspace>",String.fromCharCode(160))).split(/(<[a-z]+>)/g);s.length>1&&y(s);for(let t=0;t<s.length;t+=1){let n=s[t];if(n)switch(n){case"<paste>":o.execCommand("paste");break;case"<capitalize>":i=!0;break;case"<capson>":l=!0;break;case"<capsoff>":l=!1;break;case"<deleteword>":if(r){m(e);break}case"<undo>":if(r){o.execCommand("undo");break}default:{i&&(n=d(n),i=!1),l&&(n=n.toLocaleUpperCase());const t=u(n,E);c(e,t),E+=t}}}}if(e.length>0){e=e.trimLeft();const a=function(e,t){return"docs.google.com"===e&&(t.startsWith("/document/")||t.startsWith("/presentation/"))||"writer.zoho.com"===e}(b(),function(){try{return new URL(s).pathname}catch(e){return"unknown.com"}}());E=a?E.slice(-6):function(e,t){var n="";switch(e.tagName){case"INPUT":case"TEXTAREA":var a=e.value,o=e.selectionStart,r=Math.max(0,o-t);-1!==(n=a.substring(r,o)).indexOf("\n")&&(n=n.slice(n.lastIndexOf("\n")+1));break;case"DIV":case"P":default:var c=T();if(c&&c.getSelection){var l=c.getSelection().getRangeAt(0);const e=["SPAN","FONT","B","I","U"];let a,o,r;var i=l.startContainer;if(3===i.nodeType)if(r=l.startOffset,r-t>0)o=r-t,n=i.textContent.substring(o,r);else{if(o=0,n=i.textContent.substring(o,r),i.previousSibling)for(a=i.previousSibling;3!==a.nodeType&&1===a.nodeType&&-1!==e.indexOf(a.nodeName);)a=a.childNodes[a.childNodes.length-1];if(a&&3===a.nodeType){var s=t-r;r=a.textContent.length,o=Math.max(0,r-s),n=a.textContent.substring(o,r)+n}}else if(l.startOffset>0){for(a=i.childNodes[l.startOffset-1];3!==a.nodeType&&1===a.nodeType&&-1!==e.indexOf(a.nodeName);)a=a.childNodes[a.childNodes.length-1];3===a.nodeType&&(r=a.textContent.length,o=Math.max(0,r-t),n=a.textContent.substring(o,r))}}}return n}(n,6);try{if("INPUT"===n.tagName||"TEXTAREA"===n.tagName)o?"true"===localStorage.VoiceInAdvanced2?N(n,e):_(n,e):function(e,n){function a(e,t){var n=e.selectionStart,a=e.selectionEnd,o=e.value;e.value=o.substring(0,n)+t+o.substring(a);var r=n+t.length;e.setSelectionRange(r,r)}t(`insertTextIntoTextArea "${n}"`);const o=n.split(/(<[a-z]+>)/g);o.length>1&&y(o);var c=x();for(let t=0;t<o.length;t+=1){let n=o[t];if(n)switch(n){case"<paste>":c.execCommand("paste");break;case"<capitalize>":i=!0;break;case"<capson>":l=!0;break;case"<capsoff>":l=!1;break;case"<newparagraph>":a(e,"\n\n"),E="";break;case"<insertspace>":a(e,String.fromCharCode(160)),E+=String.fromCharCode(160);break;case"<newline>":a(e,"\n"),E="";break;case"<deleteword>":if(r){m(e);break}case"<undo>":if(r){c.execCommand("undo");break}default:{e.blur(),e.focus(),i&&(n=d(n),i=!1),l&&(n=n.toLocaleUpperCase());const t=u(n,E);a(e,t),E+=t,document.activeElement.dispatchEvent(new KeyboardEvent("keyup",{keyCode:k})),e.blur(),e.focus()}}}}(n,e);else{const a=b();o&&-1===h.indexOf(a)?"true"===localStorage.VoiceInAdvanced2?N(n,e):_(n,e):function(e,n){var a,o,c;t(`insertTextIntoContentEditable "${n}"`);const s=x(),p=w();if(p&&p.getSelection&&(a=p.getSelection()).getRangeAt&&a.rangeCount){(o=a.getRangeAt(0)).collapsed||o.deleteContents();let t=!1;const p=n.split(/(<[a-z]+>)/g);p.length>1&&y(p);for(let n=0;n<p.length;n+=1){let a=p[n];if(a)switch(a){case"<newline>":(c=document.createElement("span")).innerHTML="<br>",o.insertNode(c),o.collapse(!0),o.setStartAfter(c),o.setEndAfter(c),E="";break;case"<newparagraph>":c=document.createElement("br"),o.insertNode(c),o.collapse(!0),o.setStartAfter(c),o.setEndAfter(c),c=document.createElement("br"),o.insertNode(c),o.collapse(!0),o.setStartAfter(c),o.setEndAfter(c),E="";break;case"<paste>":s.execCommand("paste"),t=!0;break;case"<capitalize>":i=!0;break;case"<capson>":l=!0;break;case"<capsoff>":l=!1;break;case"<insertspace>":a=String.fromCharCode(160),c=document.createTextNode(a),o.insertNode(c),o.collapse(!0),o.setStart(c,a.length),o.setEnd(c,a.length),E+=a;break;case"<deleteword>":if(r){m(e);break}case"<undo>":if(r){s.execCommand("undo"),t=!0;break}default:{i&&(a=d(a),i=!1),l&&(a=a.toLocaleUpperCase());const e=u(a,E);c=document.createTextNode(e),o.insertNode(c),o.collapse(!0),o.setStart(c,e.length),o.setEnd(c,e.length),E+=e;break}}}t||(a.removeAllRanges(),a.addRange(o)),c&&c.parentNode&&c.parentNode.normalize()}}(n,e)}}catch(e){console.error(e)}return e.length}return 0}function C(){chrome.storage.sync.get("stored_lang",(e=>{"string"==typeof(v=e.stored_lang)&&v.length>1||(v="en-US")}))}function N(){const e=b();-1!==u.indexOf(e)&&(o=!0),C(),chrome.storage.sync.get("pro",(n=>{if(n.pro){r=!0,o=!0;-1!==[].indexOf(e)?(t("paste mode disabled - exception"),o=!1):chrome.storage.sync.get("no_advancedmode_domains",(e=>{if(e.no_advancedmode_domains){for(var t=b(),n=e.no_advancedmode_domains,a=!1,r=0;r<n.length;r+=1)if(t.endsWith(n[r])){a=!0;break}a&&(o=!1)}})),chrome.storage.sync.get("changeCase",(e=>{e.changeCase&&(p=e.changeCase)}))}else{m=!1;for(var a=0;a<f.length;a+=1)if(e.endsWith(f[a])){m=!0;break}}}))}function S(e){switch(e.action){case"tab_url_change":s=e.url,d||(d=!0,N()),e.recognizing&&(c=!0);break;case"on_results":!function(e){var t=y();if(t.targetable){if(n=t.target,!r&&m)return;k(e)}}(e.txtToAdd);break;case"recognition_started_in_bg":s=e.url,d?C():(d=!0,N()),c=!0;break;case"recognition_stopped_in_bg":c=!1;break;case"lang_update":C();break;case"plus_activated":N()}}chrome.runtime.onMessage.addListener((e=>{try{t(e),S(e)}catch(e){const n=(s||window.location.href||"").slice(0,60);!function(e,n,a,o=!0){t("VIGA",e,n,a),chrome.runtime.sendMessage({message_id:"track",category:e,action:n,label:a,interaction:o})}("JSError-CSA",`${e.name}:${e.message}`,""+n),console.error(e)}}))}onload();